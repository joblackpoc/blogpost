{% extends 'base.html' %}

{% block title %}{{ action }} Post - SecureBlog{% endblock %}

{% block extra_css %}
<style>
    .ck-editor__editable {
        min-height: 400px;
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-body p-5">
                <h2 class="mb-4">
                    <i class="fas fa-edit"></i> {{ action }} Post
                </h2>
                
                <form method="post" enctype="multipart/form-data" id="post-form">
                    {% csrf_token %}
                    
                    <div class="mb-3">
                        <label for="{{ form.title.id_for_label }}" class="form-label">Title</label>
                        {{ form.title }}
                        {% if form.title.errors %}
                            <div class="text-danger">{{ form.title.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.category.id_for_label }}" class="form-label">Category</label>
                        {{ form.category }}
                        {% if form.category.errors %}
                            <div class="text-danger">{{ form.category.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.excerpt.id_for_label }}" class="form-label">Excerpt</label>
                        {{ form.excerpt }}
                        {% if form.excerpt.errors %}
                            <div class="text-danger">{{ form.excerpt.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.content.id_for_label }}" class="form-label">Content</label>
                        {{ form.content }}
                        {% if form.content.errors %}
                            <div class="text-danger">{{ form.content.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.featured_image.id_for_label }}" class="form-label">Featured Image</label>
                        {{ form.featured_image }}
                        {% if form.featured_image.errors %}
                            <div class="text-danger">{{ form.featured_image.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.status.id_for_label }}" class="form-label">Status</label>
                        {{ form.status }}
                        {% if form.status.errors %}
                            <div class="text-danger">{{ form.status.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="btn-group">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Save Post
                        </button>
                        <a href="{% url 'blog:post_list' %}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.ckeditor.com/ckeditor5/40.0.0/super-build/ckeditor.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    
    CKEDITOR.ClassicEditor.create(document.querySelector('#id_content'), {
        toolbar: {
            items: [
                'heading', '|',
                'bold', 'italic', 'link', 'underline', 'strikethrough', '|',
                'bulletedList', 'numberedList', '|',
                'blockQuote', 'uploadImage', '|',
                'fontSize', 'fontColor', 'fontBackgroundColor', '|',
                'insertTable', '|',
                'undo', 'redo'
            ],
            shouldNotGroupWhenFull: true
        },
        image: {
            toolbar: [
                'imageTextAlternative', '|',
                'imageStyle:inline',
                'imageStyle:block',
                'imageStyle:side', '|',
                'toggleImageCaption', 'imageStyle:alignLeft', 'imageStyle:alignCenter', 'imageStyle:alignRight'
            ]
        },
        simpleUpload: {
            uploadUrl: '/blog/ckeditor/upload/',
            withCredentials: true,
            headers: {
                'X-CSRFToken': csrfToken
            }
        }
    }).then(editor => {
        window.editor = editor;
        console.log('CKEditor initialized with image upload support');
    }).catch(error => {
        console.error('CKEditor initialization error:', error);
    });
});
</script>
{% endblock %}
